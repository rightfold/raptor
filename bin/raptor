#!/usr/bin/env racket
#lang racket

(define racket-path (find-executable-path "racket"))
(define raco-path (find-executable-path "raco"))

(define (help)
  (display "help: raptor [command]\n"))

(define (run bin)
  (system* racket-path (string-append "bin/" bin) #:set-pwd? #t))

(define (test)
  (system* raco-path "test" "." #:set-pwd? #t))

(define (set-PLTCOLLECTS)
  (let* ((key "PLTCOLLECTS")
         (old (or (getenv key) ""))
         (new (string-append old ":" (path->string (current-directory)))))
    (putenv key new)))

(define (main)
  (set-PLTCOLLECTS)
  (match (current-command-line-arguments)
    ((vector)           (help))
    ((vector "help")    (help))
    ((vector "run" bin) (run bin))
    ((vector "test")    (test))
  )
)

(main)
